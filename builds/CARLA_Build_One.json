{
  "name": "CARLA_Build_One",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "carla-create-booking",
        "responseMode": "lastNode"
      },
      "id": "Webhook",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [100, 300]
    },
    {
      "parameters": {
        "functionCode": "const body = $json;\n\nconst calendarId = body.calendar_id || body.item_id || 'unknown';\nconst description = (body.description || '').toLowerCase();\nconst summary = (body.summary || '').toLowerCase();\nconst isHold = summary.includes('hold') || description.includes('hold');\n\nconst studioMap = {\n  'Studio A': { sku: 'studio-a', checkfrontId: 5288 },\n  'Studio B': { sku: 'studio-b', checkfrontId: 99834 },\n  'Studio C': { sku: 'studio-c', checkfrontId: 99835 },\n  'Studio D': { sku: 'studio-d', checkfrontId: 99836 },\n  'Studio E': { sku: 'studio-e', checkfrontId: 99837 }\n};\n\nconst studioName = body.booking_item || body.studio || 'Studio B';\nconst meta = studioMap[studioName] || { sku: 'unknown', checkfrontId: 99834 };\n\nreturn [{\n  json: {\n    ...body,\n    isHold,\n    ...meta\n  }\n}];"
      },
      "id": "Transform Metadata",
      "name": "Transform Metadata",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [300, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json.isHold }}",
              "value2": true
            }
          ]
        }
      },
      "id": "Check if HOLD",
      "name": "Check if HOLD",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [500, 300]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://centra-studios.manage.na1.bookingplatform.app/api/3.0/booking",
        "jsonParameters": true,
        "bodyParametersJson": "{\"items\":{\"99834\":{\"qty\":1,\"date\":\"2025-05-28\",\"start_time\":\"10:00\",\"end_time\":\"12:00\"}},\"customer\":{\"first_name\":\"Webhook\",\"last_name\":\"Test\",\"email\":\"webhook@example.com\"},\"status\":\"HOLD\"}"
      },
      "id": "Create HOLD Booking",
      "name": "Create HOLD Booking",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [700, 200]
    },
    {
      "parameters": {
        "requestMethod": "POST",
        "url": "https://centra-studios.manage.na1.bookingplatform.app/api/3.0/booking",
        "jsonParameters": true,
        "bodyParametersJson": "{\"items\":{\"99834\":{\"qty\":1,\"date\":\"2025-05-28\",\"start_time\":\"10:00\",\"end_time\":\"12:00\"}},\"customer\":{\"first_name\":\"Webhook\",\"last_name\":\"Test\",\"email\":\"webhook@example.com\"},\"status\":\"PEND\"}"
      },
      "id": "Create Confirmed Booking",
      "name": "Create Confirmed Booking",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [700, 400]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Transform Metadata",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transform Metadata": {
      "main": [
        [
          {
            "node": "Check if HOLD",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check if HOLD": {
      "main": [
        [
          {
            "node": "Create HOLD Booking",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Confirmed Booking",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {},
  "id": "CARLA_Webhook_Sync"
}
