
{
  "meta": {
    "version": "2.0",
    "description": "Phase 2: Bi-directional booking sync, HOLD logic, deduplication, logging",
    "workflowName": "CARLA_Build_Two"
  },
  "features": [
    "Google Calendar event updates trigger Checkfront edits",
    "GCal deletions cancel Checkfront bookings",
    "Checkfront webhooks update GCal entries",
    "HOLD detection from both GCal + Checkfront",
    "Deduplication of bookings",
    "Optional Discord logging (not yet active)"
  ],
  "nodes": [
    {
      "name": "Google Calendar Trigger",
      "type": "trigger",
      "action": "onEventCreatedOrUpdated",
      "studios": ["Studio A", "Studio B", "Studio C", "Studio D", "Studio E"]
    },
    {
      "name": "Parse GCal Booking",
      "type": "function",
      "action": "extract booking metadata, studio, status, isHold"
    },
    {
      "name": "Find Existing Checkfront Booking",
      "type": "httpRequest",
      "action": "GET /booking",
      "match": "by event ID or time range"
    },
    {
      "name": "Create or Update Booking",
      "type": "switch",
      "cases": [
        "isHold === true → Create HOLD booking",
        "notFound → Create booking",
        "found → Update existing"
      ]
    },
    {
      "name": "Create Checkfront Booking",
      "type": "httpRequest",
      "action": "POST /booking/create",
      "headers": ["API Key"],
      "body": "compiled from GCal metadata"
    },
    {
      "name": "Update Checkfront Booking",
      "type": "httpRequest",
      "action": "POST /booking/update",
      "headers": ["API Key"],
      "body": "updated metadata"
    },
    {
      "name": "Cancel Checkfront Booking",
      "type": "httpRequest",
      "action": "POST /booking/cancel",
      "when": "GCal event deleted"
    },
    {
      "name": "Checkfront Webhook: Booking Changed",
      "type": "webhook",
      "url": "carla-booking-modified",
      "action": "Parse + reflect booking change back into GCal"
    },
    {
      "name": "Parse Checkfront Webhook",
      "type": "function",
      "action": "extract booking_id, status, item, date"
    },
    {
      "name": "Sync to Google Calendar",
      "type": "httpRequest",
      "action": "PATCH /calendar/v3/events",
      "includes": ["time", "title", "status"]
    },
    {
      "name": "Deduplication + Status Switch",
      "type": "switch",
      "logic": [
        "skip if already matched",
        "route by booking status: Confirmed vs Cancelled vs Hold"
      ]
    },
    {
      "name": "Log to Console",
      "type": "function",
      "enabled": true
    },
    {
      "name": "Log to Discord (future)",
      "type": "webhook",
      "url": "carla-discord-log",
      "enabled": false
    }
  ],
  "webhooks": [
    {
      "name": "carla-booking-modified",
      "token": "",
      "method": "POST",
      "active": true
    }
  ],
  "status": "Ready for deployment",
  "deployment": {
    "destination": "/volume1/docker/carla/carla-brain/builds/CARLA_Build_Two.json",
    "alias": "yeehaw"
  }
}
