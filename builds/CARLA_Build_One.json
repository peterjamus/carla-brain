{
  "name": "CARLA: Checkfront Webhook Flow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "carla-create-booking",
        "authentication": "none",
        "responseCode": 200,
        "responseMode": "lastNode",
        "responseData": "firstEntryJson"
      },
      "id": "WebhookCreate",
      "name": "Webhook: Create Booking",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [300, 300]
    },
    {
      "parameters": {
        "functionCode": "const auth = $json.headers['authorization'];\nif (auth !== 'Bearer yeehaw') {\n  throw new Error('Unauthorized: Missing or incorrect token');\n}\nreturn items;"
      },
      "id": "VerifyToken",
      "name": "Verify Header Token",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [500, 300]
    },
    {
      "parameters": {
        "url": "https://centra-studios.manage.na1.bookingplatform.app/api/3.0/booking/create",
        "method": "POST",
        "authentication": "none",
        "responseFormat": "json",
        "jsonParameters": true,
        "options": {},
        "bodyParametersJson": "{\n  \"items\": {\n    \"99834\": {\n      \"qty\": 1,\n      \"date\": \"={{ $json.body.items['99834'].date }}\",\n      \"start_time\": \"={{ $json.body.items['99834'].start_time }}\",\n      \"end_time\": \"={{ $json.body.items['99834'].end_time }}\"\n    }\n  },\n  \"customer\": {\n    \"first_name\": \"={{ $json.body.customer.first_name }}\",\n    \"last_name\": \"={{ $json.body.customer.last_name }}\",\n    \"email\": \"={{ $json.body.customer.email }}\"\n  },\n  \"status\": \"={{ $json.body.status }}\"\n}"
      },
      "id": "CheckfrontCreate",
      "name": "Create Booking in Checkfront",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 1,
      "position": [700, 300],
      "credentials": {
        "httpHeaderAuth": {
          "id": "Checkfront-API-Header-Auth",
          "name": "Checkfront Header Auth"
        }
      },
      "headers": {
        "headerParametersJson": "[{\"name\": \"X-APP-APIKEY\", \"value\": \"1c4e8b53ef94de353a2ed031d41fb47e4f6edc7c\"}]"
      }
    }
  ],
  "connections": {
    "Webhook: Create Booking": {
      "main": [[{"node": "Verify Header Token","type": "main","index": 0}]]
    },
    "Verify Header Token": {
      "main": [[{"node": "Create Booking in Checkfront","type": "main","index": 0}]]
    }
  },
  "active": false,
  "settings": {},
  "versionId": "carla-webhook-checkfront-test"
}
